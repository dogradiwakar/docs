
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Demystifying inner-workings of Apache Spark">
      
      
      
        <meta name="author" content="Diwakar Dogra">
      
      
        <link rel="canonical" href="https://dogradiwakar.github.io/GettingStarted/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>GettingStarted - Apache Spark</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Apache Spark" class="md-header__button md-logo" aria-label="Apache Spark" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Apache Spark
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GettingStarted
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Apache Spark" class="md-nav__button md-logo" aria-label="Apache Spark" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Apache Spark
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Apache Spark
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Apache Spark" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Apache Spark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          GettingStarted
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GettingStarted
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-spark" class="md-nav__link">
    Why Spark?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-spark-components-as-a-unified-stack" class="md-nav__link">
    Apache Spark Components as a Unified Stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-sparks-distributed-execution-model" class="md-nav__link">
    Apache Sparkâ€™s Distributed Execution Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-data-and-partitions" class="md-nav__link">
    Distributed Data and Partitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-spark-application-concepts" class="md-nav__link">
    Understanding Spark Application Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformations-actions-and-lazy-executions" class="md-nav__link">
    Transformations Actions and Lazy Executions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#narrow-and-wide-transformations" class="md-nav__link">
    Narrow and Wide Transformations
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-spark" class="md-nav__link">
    Why Spark?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-spark-components-as-a-unified-stack" class="md-nav__link">
    Apache Spark Components as a Unified Stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-sparks-distributed-execution-model" class="md-nav__link">
    Apache Sparkâ€™s Distributed Execution Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-data-and-partitions" class="md-nav__link">
    Distributed Data and Partitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-spark-application-concepts" class="md-nav__link">
    Understanding Spark Application Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformations-actions-and-lazy-executions" class="md-nav__link">
    Transformations Actions and Lazy Executions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#narrow-and-wide-transformations" class="md-nav__link">
    Narrow and Wide Transformations
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="introduction"><strong>Introduction</strong></h1>
<h2 id="why-spark"><strong>Why Spark?</strong></h2>
<p>Hadoop was the first version of distributed computing</p>
<p>Issues with HDFS</p>
<ul>
<li>Hard to manage and administer</li>
<li>Batch processing using Map Reduce</li>
<li>Large Datasets were written to disk for subsequent stages of operation which meant high i/o.</li>
<li>OK for batch processing but was slow while doing Machine learning / Streaming</li>
</ul>
<p>Spark was created in order to overcome these obstacles .</p>
<p><a href="https://spark.apache.org/">Apache Spark</a> is a unified engine designed for large-scale distributed data processing, on premises in data centers or in the cloud.</p>
<p>Spark provides in-memory storage for intermediate computations, making it much faster than Hadoop Map Reduce. It incorporates libraries with composable APIs for machine learning (MLlib), SQL for interactive queries (Spark SQL), stream processing (Structured Streaming) for interacting with real-time data, and graph processing (GraphX).</p>
<p>Sparkâ€™s design philosophy centers around four key characteristics:</p>
<p><strong>Speed</strong>
-   The Spark framework is optimized to benefit from the cheap commodity hardware nowadays (CPU / RAM)
-   Spark builds its query as Directed acrylic graph (DAG) which constructs an efficient computational graph that can be decomposed into tasks and then can be executed in parallel across the workers in cluster .
-   As data is retained in memory with limited disk i/o it has a huge performance boost .</p>
<p><strong>Ease of use</strong>
-   All the high level abstractions such as data frames/datasets are built on top of simple logical structure called RDD.
-   This eventually leads to a simple programming model .</p>
<p><strong>Modularity</strong>
-   Supports Scala/Java/Python/R
-   All the libraries are well documented and are unified
-   We can write a single application to do ML/Streaming in one go .</p>
<p><strong>Extensibility</strong>
-   Focuses on parallel computation rather than storage
-   Decouple storage and computation
-   Supports many data sources and targets Apache Hadoop, Apache Cassandra, Apache HBase, MongoDB, Apache Hive, RDBMSs, and moreâ€”and process it all in memory.
-   The community of Spark developers maintains a list of <a href="https://oreil.ly/2tIVP">third-party Spark packages</a> as part of the growing ecosystem</p>
<h2 id="apache-spark-components-as-a-unified-stack"><strong>Apache Spark Components as a Unified Stack</strong></h2>
<p><img alt="" src="/docs/GettinsStarted/overview.png" /></p>
<p>Spark has Four major components :</p>
<p>Each of these components is separate in spark core engine So in whichever language you write the code Python/R the core decomposes it into highly compact byte code that is executed in worker's JVM across the cluster .</p>
<p><strong>Spark SQL:</strong></p>
<ul>
<li>Works Well with Structured Data (RDBMS, csv, parquet , AVRO, ORC)</li>
<li>Used to Read Data from RDBMS or structured data (csv, text, json etc) and create permanent / temporary tables in spark.</li>
<li>Can be used to read data from dataframe .</li>
<li>Useful to run SQL type queries</li>
</ul>
<p><strong>Spark MLib</strong></p>
<ul>
<li>Mlib provides many popular ML algorithms built on top of high level DataFrame based API to build models .</li>
<li>These API allow to extract or transform features , build pipelines and persist models during deployment .</li>
</ul>
<p><strong>Spark Structured Streaming</strong></p>
<ul>
<li>Continuous streaming model where a stream of continuous streaming data can be consumed .</li>
<li>Developers can treat these streams as tables and query them.</li>
<li>Used to combine and react in real time to both static data and streaming data from engines like Apache Kafka , kinesis and other data sources .</li>
</ul>
<p><strong>GraphX</strong></p>
<ul>
<li>Library for manipulating Graphs and perform graph parallel computations .</li>
</ul>
<h2 id="apache-sparks-distributed-execution-model"><strong>Apache Sparkâ€™s Distributed Execution Model</strong></h2>
<p>(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image002.png)</p>
<p><strong>Spark Driver :</strong></p>
<ul>
<li>Instantiates a spark Session</li>
<li>It Communicates with cluster manager , requests resources from Cluster Manager for spark execution (JVM) , transforms spark operations into DAG, schedules operations and co-ordinates with executors .</li>
</ul>
<p><strong>Spark Session</strong></p>
<ul>
<li>Uniform conduit for all spark operations and data</li>
<li>Used for creating JVM parameters , define Dataframe , Datasets , read data sources , access catalog metadata and issues SQL queries .</li>
<li>Entry point for all Spark functionality</li>
<li>Can be accessed using global variable spark or using sc .</li>
</ul>
<p><strong>Cluster Manager</strong></p>
<ul>
<li>Responsible for managing and allocating resources for the cluster</li>
<li>
<p>Spark supports 4 cluster managers</p>
</li>
<li>
<p>In built Standalone</p>
</li>
<li>Apache Hadoop Yarn</li>
<li>Apache Mesos</li>
<li>Kubernetes
(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image003.png)</li>
</ul>
<p><strong>Spark Executor</strong></p>
<ul>
<li>Runs on each worker node in the cluster</li>
<li>Communicates with driver program and execute tasks on the worker nodes</li>
</ul>
<h2 id="distributed-data-and-partitions"><strong>Distributed Data and Partitions</strong></h2>
<ul>
<li>Actual Physical data is stored as partitions</li>
<li>Spark treats each partition as a dataframe in memory</li>
<li>Spark Executor reads the data from its closest partition</li>
<li>Partitioning allows parallelism as Each core in partition is assigned to its own data partition to work with .</li>
</ul>
<p>(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image004.png)</p>
<p>Partitioning allows efficient parallelism . In distributed environment spark executor reads data from the nearest partition allowing efficient parallelism .
(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image005.png)</p>
<p>For example, this code snippet will break up the physical data stored across clusters into eight partitions, and each executor will get one or more partitions to read into its memory:</p>
<p>log_df = spark.read.text("path_to_large_text_file").repartition(8)<br />
print(log_df.rdd.getNumPartitions())</p>
<h2 id="understanding-spark-application-concepts"><strong>Understanding Spark Application Concepts</strong></h2>
<p>Key terminologies</p>
<ul>
<li>Application : User Program consisting of driver and spark session .</li>
<li>Spark Session : Entry point to interact with Spark functionality .</li>
<li>Job : Parallel Computation consisting of many tasks</li>
<li>Stage : Each Job is divided into smaller tasks called stages</li>
<li>Task : Single unit of work</li>
</ul>
<p><strong>Spark Application and Spark Session</strong>
At the core of Spark Application is the spark driver program which creates a SparkSession object .
While working with an interactive shell Spark session is created automatically
(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image006.png)</p>
<p><strong>Spark Jobs</strong>
When we invoke commands through spark-shell the driver converts the spark application into various spark jobs which in turn converts each job into multiple DAG's .
(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image007.png)</p>
<p><strong>Spark Stages</strong>
As park of DAG nodes stages re created based on the operations which needs to be performed .
(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image008.png)</p>
<p><strong>Spark Tasks</strong>
Each stage is comprised of multiple tasks which is a unit of execution which gets federated across the spark executors . Each task maps to a single core and works on a single partition of data .</p>
<p>For an executor with 16 core 16 or more tasks would run working on 16 or more partitions in parallel .
(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image009.png)</p>
<h2 id="transformations-actions-and-lazy-executions"><strong>Transformations Actions and Lazy Executions</strong></h2>
<p>Transformations transform a spark dataframe into a new dataframe without altering the original data as it is immutable . E.g. a select() or a filter() command will not change the original dataframe but will return a new dataframe</p>
<p>All transformations are evaluated lazily aka the results are not computed immediately but are recorded which allows spark to rearrange the transformations , optimize them into stages for efficient execution . Lazy evaluation allows spark to record transformations until an action is invoked . Each transformation produces a new dataframe .
Actions : Anything which triggers execution of a transformation like show, count etc.
(file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image010.png)</p>
<h2 id="narrow-and-wide-transformations"><strong>Narrow and Wide Transformations</strong></h2>
<p><strong>Narrow Transformation</strong> : Where a single output is partition can be computed from a single input partition . E.g. filter(), contains() operate on single partition .</p>
<p><strong>Wide Transformations</strong> : Where a shuffle of partitions happens . E.g. groupby(), orderby() leads data to be read from many partitions combine them and then written to disk .</p>
<p><img alt="" src="file:///C:/Users/Z58/AppData/Local/Temp/msohtmlclip1/02/clip_image011.png" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../about/" class="md-footer__link md-footer__link--next" aria-label="Next: About" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              About
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>